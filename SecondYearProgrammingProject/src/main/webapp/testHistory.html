<!doctype html>
<html class="no-js">
<head>
  <meta charset="utf-8">
  <title>Deutsche Akademie</title>
  <meta name="description" content="">
  <meta name=viewport content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">

  <!-- build:css styles/vendor.css -->
  <!-- bower:css -->
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/semantic-ui/0.13.0/css/semantic.min.css">
  <!-- endbower -->
  <!-- endbuild -->
  <link href='//fonts.googleapis.com/css?family=Open+Sans:400,700,300&subset=latin,vietnamese' rel='stylesheet' type='text/css'>

  <!-- build:css styles/main.css -->
  <link rel="stylesheet" href="main.css">
  <!-- endbuild -->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/semantic-ui/0.13.0/javascript/semantic.min.js"></script>
  <script type="text/javascript">
      /**
        * Gets the difference in human-readable form from the millisecond supplied to now.
        * [A modified version of http://stackoverflow.com/questions/8211744/convert-time-interval-given-in-seconds-into-more-human-readable-form]
        *
        * @param {number} milliseconds - The time to calculate the difference between, in milliseconds.
        */
       function timediff(milliseconds) 
       {
           function numberEnding (number) 
           {
               //If the number is greater than 1, use 's' (plural), otherwise, none.
               return (number > 1) ? 's' : '';
           }

           //Set the milliseconds to the difference between now and the milliseconds
               milliseconds = new Date().getTime() - milliseconds;

           var temp = Math.floor(milliseconds / 1000);
           var years = Math.floor(temp / 31536000);

           if (years)
               return years + ' year' + numberEnding(years) + " ago";

           var days = Math.floor((temp %= 31536000) / 86400);
           if (days)
               return days + ' day' + numberEnding(days) + " ago";

           var hours = Math.floor((temp %= 86400) / 3600);
           if (hours)
               return hours + ' hour' + numberEnding(hours) + " ago";

           var minutes = Math.floor((temp %= 3600) / 60);
           if (minutes)
               return minutes + ' minute' + numberEnding(minutes) + " ago";

           var seconds = temp % 60;
           if (seconds)
               return seconds + ' second' + numberEnding(seconds) + " ago";

           return 'just now';
       }

    $(document).ready(function()
    {
        $("#mainContent").hide();
        
        $.ajax("TestHistoryServlet?id=407").done(function(data)
        {
            $("#mainContent").show();
            $("#loaderRow").hide();
            
            for(var row in data)
            {
                var formattedTime = new Date(data[row].date);
                formattedTime = formattedTime.toDateString() + ", " + formattedTime.toLocaleTimeString() + " <i>(" + timediff(+formattedTime) + ")</i>";
                
                $("#mainContent .ui.table").append(
                    '<tr>' +
                        '<td>' + data[row].test_id + '</td>' +
                        '<td>' + data[row].score   + '/20 (' + Math.round(data[row].score / 20 * 100.0) + '%) </td>' +
                        '<td>' + formattedTime     + '</td>' +
                    '</tr>'
                );
            }
            
        });
    });
  </script>
</head>
<body class="home">

  <nav class="ui fixed menu inverted navbar">
    <a href="" class="brand item">Deutsche Akademie</a>
    <a href="" class="item">Home</a>
    <a href="" class="item">Edit Word</a>
    <a href="" class="item">List Words</a>
    <a href="" class="item">Take Test</a>
    <a href="" class="active item">Test History</a>
  </nav> <!-- end nav -->

  <main class="ui page grid">
     <div class="row" id="loaderRow">
        <div class="ui segment">
                <div class="ui active inverted dimmer">
                        <div class="ui large indeterminate loader"></div>
                </div>
            <p></p>
        </div>
    </div>
      
    <div class="row">
      <div class="center aligned starter column">
        <h1 class="ui header">Your Progress</h1>
        
        <div class="ui fluid segment" id="mainContent">
            <p>Here is the history of the tests you have took.</p>
            
            <table class="ui three column celled striped table">
                <thead>
                    <tr>
                        <th>Quiz ID <i class="right floated code icon"></i></th>
                        <th>Score <i class="right floated empty star icon"></i></th>
                        <th>Date <i class="right floated calendar icon"></i></th>
                    </tr>
                </thead>
            </table>
        </div>
      </div>
    </div>


  </main>

</body>
</html>